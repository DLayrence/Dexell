<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dexell 17th Invitation</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
:root{--bg1:#c7ea9a;--bg2:#eaf5e8;--panel:#fff;--accent:#f3d27a;--frame:#3b4b2a}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Arial, sans-serif;background:linear-gradient(180deg,var(--bg1) 0%,var(--bg2) 60%);color:#222}
.wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
.card{width:980px;max-width:96%;background:var(--panel);border-radius:12px;box-shadow:0 18px 44px rgba(0,0,0,0.12);overflow:hidden;display:grid;grid-template-columns:380px 1fr}
.farm{padding:18px;background:linear-gradient(180deg,#dff3c9 0,#cfe9a8 100%);display:flex;flex-direction:column;align-items:center}
.scene{width:100%;height:380px;position:relative;border-radius:10px;overflow:hidden;background:linear-gradient(#88c057 0,#6fa141 60%)}
.tiles{position:absolute;left:0;right:0;bottom:0;height:140px;background-image:linear-gradient(90deg,#7DAE3A 0 24px,#6a9c33 24px 48px);filter:contrast(1.02)}
.cloud{position:absolute;top:28px;width:320px;height:80px;background:radial-gradient(circle at 30% 40%,#fff 0 28%, rgba(255,255,255,0.6) 29% 40%, rgba(255,255,255,0.2) 41%);border-radius:60px;opacity:0.92;filter:blur(.2px)}
.cloud.c1{left:-40px;animation:cloudMove 36s linear infinite}
.cloud.c2{left:40%;top:10px;width:240px;height:60px;animation:cloudMove 52s linear infinite}
@keyframes cloudMove{from{transform:translateX(0)} to{transform:translateX(1200px)}}
.leaf-canvas{position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none}
.barn{position:absolute;right:18px;bottom:62px;width:120px;height:96px;background:#b84a4a;border:4px solid #7a2f2f;border-bottom-left-radius:8px;border-bottom-right-radius:8px;box-shadow:inset 0 -8px rgba(0,0,0,0.12)}
.barn::after{content:'';position:absolute;left:18px;top:18px;width:36px;height:40px;background:#fff1e0;border:3px solid #7a2f2f}
.char-wrap{position:absolute;left:36px;bottom:48px;width:160px;height:180px;display:flex;align-items:flex-end;justify-content:center}
.pixel-char{width:112px;height:136px;image-rendering:pixelated}
.content{padding:26px 28px;display:flex;flex-direction:column;gap:12px}
h1{margin:0;font-size:26px}
p.lead{margin:0;color:#4d4d4d}
.cta{display:flex;gap:12px;align-items:center;margin-top:8px}
.btn{background:var(--frame);border:none;color:var(--accent);padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer}
.btn.secondary{background:transparent;border:2px solid rgba(0,0,0,0.06);color:#333}
.dialog{position:relative;margin-top:8px;background:#fefbe8;border:4px solid #3b4b2a;border-radius:8px;padding:12px 12px;font-family:'Press Start 2P',monospace;color:#222;box-shadow:8px 8px 0 rgba(0,0,0,0.06)}
.dialog .portrait{display:inline-block;vertical-align:top;margin-right:10px}
.dialog .text{display:inline-block;vertical-align:top;max-width:520px;font-size:12px;line-height:1.35}
.dialog.hidden{display:none}
.dialog .hint{font-size:10px;color:#666;margin-top:8px}
.rsvp-inline{margin-top:12px;background:#fff;padding:12px;border-radius:8px;border:1px solid #eee;display:none}
.rsvp-inline.show{display:block}
.field-row{display:flex;gap:8px;margin-bottom:10px}
input[type=text]{flex:1;padding:10px;border-radius:6px;border:2px solid #e6e1d3;background:#fff8e6}
.choices{display:flex;gap:8px;align-items:center}
.choices label{display:inline-flex;align-items:center;gap:6px;padding:8px 10px;border-radius:6px;border:1px solid #eee;cursor:pointer;background:#fffdf6}
.small{font-size:13px;color:#666}
@media(max-width:960px){.card{grid-template-columns:1fr}.scene{height:260px}.char-wrap{left:28px}}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="farm">
      <div style="font-family:'Press Start 2P',monospace;color:var(--frame);margin-bottom:8px">Dexell 17th Invitation</div>
      <div class="scene" id="scene">
        <div class="cloud c1"></div>
        <div class="cloud c2"></div>
        <canvas class="leaf-canvas" id="leafCanvas"></canvas>
        <div class="tiles"></div>
        <div class="barn"></div>
        <div class="char-wrap">
          <svg class="pixel-char" viewBox="0 0 112 136" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges">
            <rect x="20" y="4" width="72" height="12" fill="#8b5a2b"/>
            <rect x="18" y="14" width="76" height="10" fill="#8b5a2b"/>
            <rect x="32" y="24" width="48" height="6" fill="#2b1f12"/>
            <rect x="28" y="30" width="56" height="6" fill="#2b1f12"/>
            <rect x="36" y="38" width="40" height="28" fill="#ffd9b6"/>
            <g id="eyesOpen">
              <rect x="46" y="48" width="6" height="4" fill="#2b1f12"/>
              <rect x="60" y="48" width="6" height="4" fill="#2b1f12"/>
            </g>
            <g id="eyesClosed" style="display:none">
              <rect x="46" y="50" width="20" height="2" fill="#2b1f12"/>
            </g>
            <rect x="54" y="62" width="4" height="2" fill="#b3603a"/>
            <rect x="28" y="68" width="56" height="36" fill="#6aa84f"/>
            <rect x="22" y="68" width="6" height="20" fill="#d98a47"/>
            <rect x="84" y="68" width="6" height="20" fill="#d98a47"/>
            <rect x="36" y="104" width="40" height="18" fill="#6b4b2a"/>
            <rect x="36" y="122" width="12" height="8" fill="#3b2b1b"/>
            <rect x="60" y="122" width="12" height="8" fill="#3b2b1b"/>
          </svg>
        </div>
      </div>
      <div class="small" style="margin-top:10px">-Dexell Layrence</div>
    </div>

    <div class="content">
      <h1>Invitation</h1>
      <p class="lead">Halo keluargaku mohon diisi ya gengs</p>

      <div class="cta">
        <button class="btn" id="talkBtn">Gasss</button>
        <button class="btn secondary" id="resetBtn">Hapus Absensi</button>
      </div>

      <div class="dialog hidden" id="dialogBox">
        <div class="portrait" aria-hidden="true">
          <svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges">
            <rect x="4" y="4" width="52" height="52" fill="#fff9ea"/>
            <rect x="12" y="10" width="36" height="8" fill="#2b1f12"/>
            <rect x="16" y="22" width="10" height="10" fill="#ffd9b6"/>
            <rect x="34" y="22" width="10" height="10" fill="#ffd9b6"/>
            <rect x="16" y="34" width="28" height="12" fill="#6aa84f"/>
          </svg>
        </div>
        <div class="text" id="dialogText"> </div>
        <div class="hint">Tekan tombol "Gasss" untuk ulangi. Tekan spasi untuk lanjut setiap baris dialog.</div>
      </div>

      <div class="rsvp-inline" id="rsvpArea">
        <div style="font-weight:700;margin-bottom:8px">Isi Absensi</div>
        <div class="field-row">
          <input type="text" id="nameInput" placeholder="Nama kamu" />
          <div class="choices">
            <label><input type="radio" name="attend" value="Hadir" checked/> Hadir</label>
            <label><input type="radio" name="attend" value="Tidak Hadir"/> Tidak hadir</label>
          </div>
        </div>
        <div style="display:flex;gap:8px">
          <button class="btn" id="submitRsvp">Kirim</button>
          <button class="btn secondary" id="closeRsvp">Tutup</button>
        </div>
        <div class="small" style="margin-top:10px">Absensi akan tersimpan di cloud (Firebase).</div>
      </div>

      <div id="listArea" style="margin-top:12px"></div>

    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyA4FqcysJIxf8jfoEcZTCwd_mVJ1k3Tq2w",
  authDomain: "dexell-a1596.firebaseapp.com",
  projectId: "dexell-a1596",
  storageBucket: "dexell-a1596.firebasestorage.app",
  messagingSenderId: "443118242047",
  appId: "1:443118242047:web:c3f65a24f9fd9f4b57e4ca",
  measurementId: "G-35J92D7XMD"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Dialog
const lines = [
  'Halo! Aku Dexell. Selamat datang!.',
  'Saya akan mengadakan acara makan2 untuk kita semua.',
  'Boleh dong kamu isi nama dan pilih hadir atau tidak.',
  'Terima kasih! Sampai jumpa di tempat.'
];

const talkBtn = document.getElementById('talkBtn');
const dialogBox = document.getElementById('dialogBox');
const dialogText = document.getElementById('dialogText');
const rsvpArea = document.getElementById('rsvpArea');
const submitRsvp = document.getElementById('submitRsvp');
const closeRsvp = document.getElementById('closeRsvp');
const nameInput = document.getElementById('nameInput');
const listArea = document.getElementById('listArea');
const resetBtn = document.getElementById('resetBtn');

let currentLine = 0; let typing = false; let cancelTyping = false;

function typeText(text, el, speed=24){
  return new Promise(resolve=>{
    typing = true; cancelTyping = false; el.textContent = '';
    let i=0; function step(){ if(cancelTyping){ el.textContent = text; typing=false; resolve(); return } if(i<=text.length){ el.textContent = text.slice(0,i); i++; setTimeout(step, speed); } else { typing=false; resolve(); } }
    step();
  });
}

async function playDialog(){
  dialogBox.classList.remove('hidden');
  rsvpArea.classList.remove('show');
  currentLine = 0;
  startBlinking();
  while(currentLine < lines.length){
    await typeText(lines[currentLine], dialogText, 20);
    await waitForAdvance(900);
    currentLine++;
  }
  stopBlinking();
  rsvpArea.classList.add('show');
  nameInput.focus();
}

function waitForAdvance(timeout){
  return new Promise(resolve=>{
    let done=false; function proceed(){ if(done) return; done=true; document.removeEventListener('keydown', onKey); resolve(); }
    function onKey(e){ if(e.code==='Space'){ e.preventDefault(); proceed(); } }
    document.addEventListener('keydown', onKey);
    setTimeout(()=>{ proceed(); }, timeout);
  });
}

let blinkInterval=null;
function startBlinking(){ 
  const open = document.getElementById('eyesOpen'); 
  const closed = document.getElementById('eyesClosed'); 
  blinkInterval = setInterval(()=>{ 
    open.style.display='none'; 
    closed.style.display='inline'; 
    setTimeout(()=>{ open.style.display='inline'; closed.style.display='none'; },120); 
  }, 4800); 
}
function stopBlinking(){ if(blinkInterval) clearInterval(blinkInterval); }

// Leaf canvas animation (kosong sementara)
const leafCanvas = document.getElementById('leafCanvas'); const ctx = leafCanvas.getContext('2d'); 
function resizeCanvas(){ leafCanvas.width = leafCanvas.clientWidth; leafCanvas.height = leafCanvas.clientHeight; }
window.addEventListener('resize', resizeCanvas); resizeCanvas();

// Tombol dialog
talkBtn.onclick = ()=>{ playDialog(); };

// Tombol Kirim Absensi
submitRsvp.onclick = async ()=>{
  const nama = nameInput.value.trim();
  if(!nama) return alert("Masukkan nama dulu!");
  const status = document.querySelector("input[name='attend']:checked").value;
  try{
    await addDoc(collection(db,"rsvp"),{nama,status});
    nameInput.value="";
    alert("Absensi terkirim!");
  }catch(e){ alert("Gagal kirim absensi: "+e.message); }
};

// Tombol Close RSVP
closeRsvp.onclick = ()=>{ rsvpArea.classList.remove('show'); };

// Tampilkan list realtime
onSnapshot(collection(db,"rsvp"), snap=>{
  let html = "<div style='font-weight:700;margin-bottom:6px'>Daftar Absensi:</div>";
  snap.docs.forEach(d=>{
    html += `<div>${d.data().nama} - ${d.data().status}</div>`;
  });
  listArea.innerHTML = html;
});

// Tombol Reset dengan password 2626
resetBtn.onclick = async ()=>{
  const pass = prompt("Masukkan password untuk hapus absensi:");
  if(pass !== "2626") return alert("Password salah!");
  if(!confirm("Yakin hapus semua absensi?")) return;
  const snap = await getDocs(collection(db, "rsvp"));
  for(const d of snap.docs){
    await deleteDoc(doc(db, "rsvp", d.id));
  }
  alert("Semua absensi berhasil dihapus!");
};
</script>
</body>
</html>
